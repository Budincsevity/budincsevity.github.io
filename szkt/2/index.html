<!DOCTYPE html>
<html>
  <head>
    <title>2-es villamos</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
			html, body, #map-canvas {
				height: 100%;
				margin: 0px;
				padding: 0px
			}
			#panel {
        width: auto;
				position: absolute;
				top: 5px;
				left: 50%;
				z-index: 5;
				background-color: rgba(0, 0, 0, 0.5);
				padding: 5px;
				border: 1px solid #999;
        color: white;
        font-family: Arial;
        font-size: 22px;
        text-align: center;
			}
		</style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=geometry"></script>

    <script>
// Note: This example requires that you consent to location sharing when
// prompted by your browser. If you see a blank space instead of the map, this
// is probably because you have denied permission for location sharing.

var map;
var directionsService = new google.maps.DirectionsService();
var directionsDisplay;
var locationData = [
  new google.maps.LatLng(46.273596, 20.147050),
  new google.maps.LatLng(46.272220, 20.143077),
  new google.maps.LatLng(46.270782, 20.139110),
  new google.maps.LatLng(46.269165, 20.135835),
  new google.maps.LatLng(46.266623, 20.132448),
  new google.maps.LatLng(46.263747, 20.132367),
  new google.maps.LatLng(46.262823, 20.134972),
  new google.maps.LatLng(46.260766, 20.138901),
  new google.maps.LatLng(46.259159, 20.141914),
  new google.maps.LatLng(46.256043, 20.147736),
  new google.maps.LatLng(46.252630, 20.149168),
  new google.maps.LatLng(46.250244, 20.147646),
  new google.maps.LatLng(46.247698, 20.146865),
  new google.maps.LatLng(46.243276, 20.143570),
  new google.maps.LatLng(46.240156, 20.141166),
  new google.maps.LatLng(46.240044, 20.142872)
];

var names = [
  "Európa liget",
  "Vértó",
  "Rókusi II. sz. Ált.",
  "Rókusi víztorony",
  "Szatymazi utca",
  "Vásárhelyi Pál utca",
  "Damjanich u.",
  "Tavasz utca",
  "Rókusi templom",
  "Anna - kút",
  "Széchenyi tér",
  "Somogyi utca",
  "Aradi vértanúk tere",
  "Bécsi krt.",
  "Bem utca'",
  "Szeged pu."
];

function initialize() {
  var mapOptions = {
    zoom: 25
  };
  directionsDisplay = new google.maps.DirectionsRenderer();
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
      directionsDisplay.setMap(map);
  // Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
                                       position.coords.longitude);

      var distances = [];



      map.setCenter(pos);

      locationData.forEach(logArrayElements);
      function logArrayElements(element, index, array) {

        distances.push(google.maps.geometry.spherical.computeDistanceBetween (pos, element));
      }

      var min = Math.min.apply(Math, distances);
      var minIndex = distances.indexOf(min);

      console.log(distances.indexOf(min));
      console.log(names[minIndex]);

      $("#text").text('Legközelebbi megálló: ' + names[minIndex]);

      var request = {
            origin: pos,
            destination: locationData[minIndex],
            // Note that Javascript allows us to access the constant
            // using square brackets and a string value as its
            // "property."
            travelMode: google.maps.TravelMode.WALKING
        };
        directionsService.route(request, function(response, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);

            var infowindow = new google.maps.InfoWindow({
              map: map,
              position: pos,
              content: 'Idő: ' + response.routes[0].legs[0].duration.value
            });
          }
        });

    }, function() {
      handleNoGeolocation(true);
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
}

function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Error: The Geolocation service failed.';
  } else {
    var content = 'Error: Your browser doesn\'t support geolocation.';
  }

  var options = {
    map: map,
    position: new google.maps.LatLng(60, 105),
    content: content
  };

  var infowindow = new google.maps.InfoWindow(options);

  map.setCenter(options.position);
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="panel">
      <p id="text"></p>
      <p id="date">0 perc múlva</p>
      <p id="date">0 perc múlva</p>
    </div>
    <div id="map-canvas"></div>
  </body>
  </body>
</html>
